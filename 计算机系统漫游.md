# 第一章 计算机系统漫游

## 1.1 信息就是位+上下文

系统中的所有信息--包括磁盘文件、内存中的程序、内存中存放的用户数据以及网络上传送的数据，都是由一串**比特**表示的。区分不同数据对象的唯一方法是读到这些数据对象时的上下文。

**C语言**是贝尔实验室的Dennis Richie于1969年~1973年间创建的。**美国国家标准学会**（American National Standards Institute, ANSI）在1989年颁布了ANSI C的标准，后来C语言的标准化成了**国际标准化组织**（International standards Origanization, ISO）的责任。

## 1.2 程序被其他程序翻译成不同的格式

对于源程序`hello.c`，GCC编译器将其翻译成一个可执行目标文件`hello`。这个翻译过程分为四个阶段完成，执行这四个阶段的程序（预处理器、编译器、汇编器和链接器）一起构成了编译系统。

<div align = center>
<img src = "https://img-blog.csdnimg.cn/2019100609340741.png" width = "80%">
<div align = left>
  
**GCC**是GNU(GND是GNU's not Unix的缩写）项目开发出来的众多有用工具之一。GNU项目是1984年由Richard Stallman发起的一个免税的慈善项目。该项目的目标非常宏大，就是开发出一个完整的类Unix的系统，其源代码能够不被限制地被修改和传播。

## 1.3 了解编译系统如何工作是大有益处的

**优化程序性能**、**理解链接时出现的错误**、**避免安全漏洞**

## 1.4 处理器读并解释存储在内存中的指令

### 1.4.1 系统的硬件组成

下面是一个典型系统的硬件组成：

<div align = center>
<img src = "https://img-blog.csdnimg.cn/20191006094714780.png" width = "80%">
<div align = left>
  
**1. 总线**

总线是贯穿整个系统的一组电子管道，它携带信息字节并负责在各个部件间传递。

通常总线被设计成传送字长的字节块，也就是字（word）。字中的字节数（即字长）是个基本的系统参数，各个系统中都不尽相同。

**2. IO设备**

IO设备是与系统与外部世界的联系通道。每个IO设备都通过一个控制器或适配器与IO总线相连。

**控制器**是IO设备本身或者系统的主印制电路板（主板）上的芯片组。

**适配器**是一块插在主板插槽上的卡。

**3. 主存**

**主存**是一个临时存储设备，在处理器执行程序时，用来存放程序和程序处理的数据。

从物理上来说，主存是由一组**动态随机存取存储器**（DRAM）芯片组成的。

从逻辑上来说，存储器是一个线性的字节数组，每个字节都有其唯一的地址，这些地址是从零开始的。

**4. 处理器**

**中央处理单元**（CPU），简称处理器，是解释或执行存储在主存中指令的引擎。

处理器的核心是一个大小为一个子的存储设备（或寄存器），称为程序计数器（PC）。在任何时刻，PC都执行主存中的某条机器语言指令。

**寄存器文件**是一个小的存储设备，由一些单个字长的存储器组成，每个存储器都有唯一的名字。

下面是一个简单的执行指令的例子：

- 加载：从主存复制一个字节或者一个子到寄存器，以覆盖寄存器原来的内容。
- 存储：从寄存器复制一个字节或者一个字到主存的某个位置，以覆盖这个位置上原来的内容。
- 操作：把两个寄存器的内容复制到ALU，ALU对这两个字做算数运算，并将结果存放到一个寄存器中，以覆盖该寄存器中原来的内容。
- 跳转：从指令本身中抽取一个字，并将这个字复制到程序计数器（PC）中，以覆盖PC中原来的值。

## 1.5 高速缓存至关重要

位于处理器芯片上的**L1高速缓存**的容量可以达到数万字节，访问速度几乎和访问寄存器文件一样快。

一个容量为数十万到数百万字节的更大的**L2高速缓存**通过一条特殊的总线连接到处理器。进程访问L2高速缓存的时间要比访问L1高速缓存的时间长5倍，但仍比访问主存的时间快5-10倍。

L1和L2高速缓存是用一种**静态随机访问存储器**（SRAM）的硬件技术实现的。

比较新的、处理能力更强大的系统甚至有三级高速缓存：L1、L2和L3。

系统可以获得一个很大的存储器，同时访问速度也很快，原因是利用了高速缓存的局部性原理，即程序具有访问局部区域里的数据和代码的趋势。通过让高速缓存里存放可能经常范文的数据，大部分的内存操作能在快速的高速缓存中完成。

<div align = center>
<img src = "https://img-blog.csdnimg.cn/20191006101726343.png" width = "80%">
<div align = left>

## 1.6 存储设备形成层次结构

每个计算机系统的存储设备都被组织成了一个**存储器层次结构**，如下图所示，在这个层次结构中，从上至下，设备的访问速度越来越慢、容量越来越大，并且没字节的造价也越来越便宜。

<div align = center>
<img src = "https://img-blog.csdnimg.cn/20191006102039188.png" width = "80%">
<div align = left>
  
存储器层次结构的主要思想是上一层的存储器作为第一层存储器的高速缓存，因此，寄存器文件就是L1的高速缓存，L1是L2的高速缓存，L2是L3的高速缓存，L3是主存的高速缓存，而主存又是磁盘的高速缓存，等等。

## 1.7 操作系统管理硬件

我们可以把**操作系统**看成是应用程序和硬件之间插入的一层软件。如下图所示，所有的应用程序对硬件的操作尝试都必须通过操作系统：

<div align = center>
<img src = "https://img-blog.csdnimg.cn/20191006103229378.png" width = "80%">
<div align = left>

**操作系统**有两个基本功能：（1）防止硬件被使用的应用程序滥用；（2）向应用程序提供简单一致的机制来控制复杂而又通常大不相同的低级硬件设备。

**操作系统**通过几个基本的抽象概念（进程、虚拟内存和文件）来实现上述连个功能。

如下图所示，文件是对设备的抽象表示，虚拟内存是对主存和磁盘IO设备的抽象表示，进程则是对处理器、主存和IO设备的抽象表示。

<div align = center>
<img src = "https://img-blog.csdnimg.cn/2019100610390692.png" width = "80%">
<div align = left>

### 1.7.1 进程

当程序在现代系统上运行时，操作系统会提供一种假象，就好像系统上只有这个程序在运行。程序看上去是独占地使用处理器、主存和IO设备。处理器看上去就像在不间断地一条接一条地执行程序中的指令，即该程序的代码和数据时系统内存中唯一的对象。

**进程**是操作系统对一个正在执行的程序的一种抽象。在一个系统上可以同时运行多个进程，而每个进程都好像在独占地使用硬件。

操作系统保持跟踪进程运行所需的所有状态信息。这种状态也就是**上下文**，包括许多信息，比如PC和寄存器文件的当前值，以及主存的内容。

在任何一个时刻，但处理器系统都只能执行一个进程的代码。当操作系统决定要报控制权从当前进程转移到某个新进程时，就会进程**上下文切换**，即保存当前进程的上下文、恢复新进程的上下文，然后将控制权传递到新进程。

### 1.7.2 线程

在现代系统中，一个进程实际上可以由多个称为**线程**的执行单元组成，每个线程都运行在进程的上下文中，并共享同样的代码和全局数据。

### 1.7.3 虚拟内存

**虚拟内存**是一个抽象概念，它为每个进程提供了一个假象，即每个进程都在独占地使用主存。每个进程看到的内存都是一致的，称为**虚拟地址空间**。
